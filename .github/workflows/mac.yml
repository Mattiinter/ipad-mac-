name: macOS_iPad_Ngrok_Final
on: workflow_dispatch
jobs:
  run-mac:
    runs-on: macos-latest
    steps:
      - name: 1. Attivazione VNC Nativo Apple
        run: |
          # Password per l'utente 'runner' (quello predefinito di GitHub)
          sudo dscl . -passwd /Users/runner 1234
          
          # Attivazione del servizio Screen Sharing originale
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -clientopts -setvncpasswd -vncpasswd 1234 -restart -agent -privs -all

      - name: 2. Tunnel Ngrok (Porta 5900)
        run: |
          # Installazione veloce di ngrok via brew (molto più affidabile di Bore su Mac)
          brew install ngrok/ngrok/ngrok
          
          # Avvio del tunnel (Non serve account/token per test veloci, ma è meglio averlo)
          # Se hai un token ngrok, aggiungilo qui: ngrok config add-authtoken IL_TUO_TOKEN
          ngrok tcp 5900
