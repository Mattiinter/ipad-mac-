name: Mac_iPad_Final_VNC
on: workflow_dispatch
jobs:
  run-vnc:
    runs-on: macos-latest
    steps:
      - name: 1. Installazione Forzata TigerVNC (Metodo Diretto)
        run: |
          # Installiamo via Homebrew ma forziamo il PATH immediatamente
          brew install tiger-vnc
          echo "/opt/homebrew/opt/tiger-vnc/bin" >> $GITHUB_PATH
          
      - name: 2. Avvio Server VNC
        run: |
          # Creiamo la password in un file per evitare interazioni
          mkdir -p ~/.vnc
          # Usiamo il percorso completo per essere sicuri al 100%
          /opt/homebrew/opt/tiger-vnc/bin/vncpasswd -f <<< "123456" > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          # Avviamo il server sulla porta 5900
          /opt/homebrew/opt/tiger-vnc/bin/vncserver :1 -rfbport 5900 -localhost no -geometry 1280x800 &
          sleep 5

      - name: 3. Avvio Tunnel Bore
        run: |
          curl -L https://github.com/ekzhang/bore/releases/download/v0.5.1/bore-v0.5.1-x86_64-apple-darwin.tar.gz | tar -xz
          ./bore local 5900 --to bore.pub
